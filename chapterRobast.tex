\section{Robust MPC}

Рассмотрим линейную (дискретную) систему с возмущением:
\begin{equation*}
x(t+1) = Ax(t) + Bu(t) + w(t)
\end{equation*}
В краткой записи система имеет вид $x^+=Ax+Bu+w$.

Данная система имеет следующие ограничения: 
\begin{equation*}
x(t) \in X, u(t) \in U, w(t) \in W \ \forall t = 0,1...
\end{equation*}

$W$ является компактным, выпуклым множеством, содержащим $0$.

Главная идея робастного MPC заключается в использовании дополнительной обратной связи по ошибке, такой, что
будет обеспечивать нахождение состояния нашей системы
внутри "трубки" вокруг некого номинального состояния системы.

Определим номинальную систему следующим образом:
\begin{equation*}
z^+ = Az+Bv
\end{equation*}

В момент времени $t$, дано $z(t)$, решаем оптимизационную задачу
\begin{equation*}
\min_{v(\cdot | t)} \hat J(z(t),v(\cdot|t)) = \sum_{i=t}^{t+N-1}L(z(i|t),v(i|t)) + F(z(t+N|t))
\end{equation*} 

при условии
\begin{equation*}
z(i+1|t) = Az(i|t)+Bv(i|t), z(t|t) = z(t)
\end{equation*}
\begin{equation*}
z(i|t) \in Z, v(i|t) \in V, t \leq i \leq t+N-1
\end{equation*}
\begin{equation*}
z(t+N|t) \in Z^f \subseteq Z
\end{equation*}

Таким образом, зная оптимальное значение $v^*(\cdot|t)$, мы найдем оптимальное значение $\hat J^*(z(t))$

Предположение 1:
\begin{itemize}
\item Функция стоимости перехода является квадратичной функцией  $L(z,v) = z^TQz + v^tRv, Q,R > 0$
\item Существует локальное вспомогательное управление $k^{loc} = Kx$ такое, что
\begin{enumerate}
\item $Z^f$ инвариантно по отношению $z^+=(A+BK)z$,где $A_k = A+BK$ гурвицева, и тогда имеем $A_kZ^f \subseteq Z^f$
\item $Kz \in V \forall z \in Z^f$, т.е. локальное управление является допустимым для всех состояний терминального множества
\item $F(A_kz)-F(z) \leq - L(z,Kz) \forall z \in Z^f$
\end{enumerate}
\end{itemize}

Из предположения 1 следует, что

\begin{equation*}
\hat J^*(z(t+1)) - \hat J^*(z(t)) \leq - L(z(t), v_{MPC}(t))
\end{equation*}
Так как $L$ квадратичная, то существуют ограничения $c_2 > c_1 > 0$ такие что $\forall z \in Z_N$
\begin{enumerate}
\item $c_1|z|^2 \leq \hat J^*(z)$
\item $\hat J^*(z^+) - \hat J^*(z) \leq - c_1 |z|^2$
\item $\hat J^*(z) \leq c_2|z|^2$
\end{enumerate}

Введем понятия для рассмотрения влияния возмущения.

Сумма Минковского: 
\begin{equation*}
A,B \subseteq \mathbb{R}^n A \oplus B = \{ a+b | a \in A, b\in B\}
\end{equation*}

Разница Понтрягина:
\begin{equation*}
A, B \subseteq \mathbb{R}^n A \ominus B = \{ a \in \mathbb{R}^n| a+b \in A, \forall b \in B\}
\end{equation*}

$S$ является робастным инвариантным множеством для $x^+=Ax+w$ если $AS \oplus W \subseteq S$ 
(или эквивалентно $Ax+w \in S \forall x \in S, \forall w \in W$)

Минимальное робастное инвариантное множество:
\begin{equation*}
S_{\infty} = \sum_{i = 0}^{\infty} A^iw
\end{equation*}

Следует отметить, что представленная выше сумма существует и ограничена, если  $A$ является матрицей Шура.

В общем случае трудно подсчитать $S_{\infty}$. Однако в некоторых случаях мы можем приближенно 
найти это множество.

Пусть наше управление выглядит следующим образом:

\begin{equation*}
u_{MPC} = v_{MPC}(x) + K (x - z)
\end{equation*}

Пусть $x^+ = Ax + Bu + w$ и $z^+ = Az + Bv$. Если $ x \in Z \oplus S$ и $ u = v + K(x - z)$, тогда $ X^+ \in Z^+ \oplus S$ (инвариантное множество для $x^+ = (A+BK)x + w$)

Представим алгоритм для робастного MPC 

В момент времени $t$, дано состояние $x(t)$, решаем оптимизационную задачу

\begin{equation*}
\min_{z(t|t), v(\cdot|t)} J(x(t),v(\cdot|t)) = \sum_{i = 1}^{t+ N -1}L(z(i|t), v(i|t)) + F(z(t+N|t))
\end{equation*}
при условии
\begin{equation*}
z(i+1|t) = Az(i|t) + Bv(i|t)
\end{equation*}  
\begin{equation*}
z(i|t) \in Z = X \ominus S 
\end{equation*}
\begin{equation*}
v(i|t) \ \in V = U \ominus KS
\end{equation*}
\begin{equation*}
t \leq i \leq t + N -1
\end{equation*}
\begin{equation*}
z(t+N|t) \in Z_N \subseteq Z 
\end{equation*}
\begin{equation*}
x(t) \in z(t|t) \oplus S 
\end{equation*}

Оптимальное значение для $J^*(x(t))$
достигается в $z^*(t|t), v^*(\cdot|t)$, тогда строим управление для исходной задачи в виде: 
\begin{equation*}
u(t) = v^*(t|t) + K(x(t) - z^*(t|t))
\end{equation*}

Свойство робастного MPC 
\begin{itemize}
\item Множество $X_N = Z_N \oplus S \subseteq X$ допустимо и достижимо
\item Равенство $J^*(x) = \hat{J^*}(z^*(x))$ верно по определению $J^*$ и $\hat J^*$
\item $J^*(x) = 0 \ \forall x \in S$ 
\end{itemize}    

\begin{Theorem} Пусть предположение 1 выполняется
и система робастного MPC разрешима в точке $t = 0$.

Тогда: 
\begin{enumerate}
\item задача робастного MPC рекуррентно разрешима
\item замкнутая система робастно экспоненциально
сходится к  $S$
\item замкнутая система удовлетворяет ограничениям
на управление и состояния, то есть $x(t) \in X$, $u(t) \in U \ \forall t = 0,1 ...$
\end{enumerate} 
\end{Theorem}

Важным обобщением использования робастного MPC является
применение его к системама вида
\begin{equation*}
x(t+1) = A(t)x(t) + B(t)u(t)
\end{equation*}
$(A(t),B(t)) \in \rho : con{(A_j,B_j), j = 1,...,J} \ \forall \geq 0$ 

Введем значения: $\bar{A} := \frac{1}{J}\sum_{i=0}^{J}A_i$, $\bar{B} := \frac{1}{J}\sum_{i=0}^{J}B_i$, которые являются средним арифметическим для матриц $A$ и $B$. Тогда рассмотрим новую систему относительно этих средних значений и возмущением будем называть отклонение от этих средних значений.
\begin{equation*}
x(t+1) = \bar{A}x(t) + \bar{B}u(t) + w(t)
\end{equation*}
\begin{equation*}
w(t) \in W := \{(A-\bar{A})x + (B-\bar{B})u | (A,B) \in \rho, x \in X, u \in U \}
\end{equation*}
$W$ является компактом, если $X$,$U$ компакты, тогда мы можем применять робастное MPC в новой формулировке.

Как уже говорилось, сложно вычислить в общем случае
минимальное робастное инвариантное множество  $S_{\infty} = \sum_{i=0}^{\infty}A^iw$

Представим один из способов его аппроксимации.

Определим $S_k := \sum_{i=0}^{k-1}A^iw, \ k \geq 1$

В общем случае, $S_k$ для конечного $k$ не является
инвариантным (это верно только в том случае, если $A$ нильпотентна)

\begin{Theorem}

Если $0 \in int(W)$ и $A$ является матрицей Шура, тогда
существует целое число $k > 0$ и $\alpha \in [0,1)$ такое, что
\begin{equation}\label{RPI_set_subset_with_alpha}
A^kW \subseteq \alpha W
\end{equation} 

Если (\ref{RPI_set_subset_with_alpha}) выполняется, то
\begin{equation*}
S(\alpha,k) := (1-\alpha)^{-1}S_k
\end{equation*}
является инвариантным множеством для $x^+ = Ax + w$

\end{Theorem}

Представим алгоритм для нахождения инвариантного
множества
\begin{enumerate}
\item Фиксируем $\alpha \in (0,1)$ и целое $k > 0$
\item проверяем, выполняется ли (\ref{RPI_set_subset_with_alpha}):
\begin{itemize}
\item если да: $S(\alpha,k)$ - это инвариантное множество
\item если нет: устанавливаем $k := k+1$ и
переходим к шагу (2)
\end{itemize}
\end{enumerate}
   