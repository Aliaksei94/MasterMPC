\section{Robust MPC}

Рассмотрим линейную (дискретную) систему:
$x(t+1) = Ax(t) + Bu(t) + w(t)$
или в краткой записи $x^+=Ax+Bu+w$

Введем следующие ограничения: $x(t) \in X, u(t) \in U, \forall t = 0,1...$

Ограничения на $W$:
$W$ является компактным, выпуклым множеством, содержащим $0$. $w(t) \in W \ \forall t =0,1,...$

Главная идея:
используем дополнительную обратную связь по ошибке, такую, что
будет обеспечивать нахождения состояния нашей системы
внутри "трубки" вокруг некого номинального состояния системы.

Определим номинальную систему следующим образом:
\begin{equation*}
z^+ = Az+Bv
\end{equation*}

В момент времени $t$, дано $z(t)$, решаем 
\begin{equation*}
\min_{v(\cdot | t)} \hat J(z(t),v(\cdot|t)) = \sum_{i=t}^{t+N-1}L(z(i|t),v(i|t)) + F(z(t+N|t))
\end{equation*} 

такое что 
\begin{equation*}
z(i+1|t) = Az(i|t)+Bv(i|t), z(t|t) = z(t)
\end{equation*}
\begin{equation*}
z(i|t) \in Z, v(i|t) \in V, t \leq i \leq t+N-1
\end{equation*}
\begin{equation*}
z(t+N|t) \in Z^f \subseteq Z
\end{equation*}

Таким образом, найдя оптимально значения $V^*(\cdot|t)$, мы 
найдем оптимальное значение $\hat J^*(z(t))$

Предположение 1:
\begin{itemize}
\item Стоимость является квадратичной функцией  $L(z,v) = z^TQz + v^tRv, Q,R > 0$
\item Существует локальное вспомогательное управление $k^{loc} = Kx$ такое что
\begin{enumerate}
\item $Z^f$ инвариантно по отношению $Z^+=(A+BK)z$, $A_k = A+BK$, i.e. $A_kZ^f \subseteq Z^f$
\item $Kz \in V \forall z \in Z^f$
\item $F(A_kz)-F(z) \leq - L(z,Kz) \forall z \in Z^f$
\end{enumerate}
\end{itemize}

Из предположения 1 следует, что

\begin{equation*}
\hat J^*(z(t+1)) - \hat J^*(z(t)) \leq - L(z(t), v_{MPC}(t))
\end{equation*}
Так как $L$ квадратичная, то существуют ограничения $c_2 > c_1 > 0$ такие что $\forall z \in Z_N$
\begin{enumerate}
\item $c_1|z|^2 \leq \hat J^*(z)$
\item $\hat J^*(z^+) - \hat J^*(z) \leq - c_1 |z|^2$
\item $\hat J^*(z) \leq c_2|z|^2$
\end{enumerate}

Влияние возмущения:
\begin{definition}
Сумма Минковского: 
\begin{equation*}
A,B \subseteq \mathbb{R}^n A \oplus B = \{ a+b | a \in A, b\in B\}
\end{equation*}

Разница Понтрягина:
\begin{equation*}
A, B \subseteq \mathbb{R}^n A \ominus B = \{ a \in \mathbb{R}^n| a+b \in A, \forall b \in B\}
\end{equation*}
\begin{equation*}
(A \ominus B) \oplus B \subseteq A
\end{equation*}
\begin{equation*}
A \subseteq (A \oplus B) \ominus B
\end{equation*}
\end{definition}
\begin{definition}

Робастное инвариантное множество :

$S$ является робастным инвариантным множеством для $x^+=Ax+w$ если $AS \oplus W \subseteq S$ 
(или эквивалентно $Ax+w \in S \forall x \in S, \forall w \in W$)
\end{definition}
\begin{example}

$x^+ = 0.5x + w$. $w \in [-5,5]$. Робастное инвариантное множество: $S = [-20, 20]$, минимальное: $S = [-10,10]$
\end{example}

Минимальное робастное инвариантное множество:
\begin{equation*}
S_{\infty} = \sum_{i = 0}^{\infty} A^iw
\end{equation*}

Следует отметить, что представленная выше сумма существует и ограничена, если  $A$ является мартрицей Шура.

В общем случае трудно подсчитать $S_{\infty}$.

Однако в некоторых случаях мы можем приближенно 
найти это множество.

\begin{example} 

Найти робастное инвариантное множество:
\begin{equation*}
S_{\infty} = \sum_{i=0}^{\infty} A^iw
\end{equation*}
Для заданной системы с ограниченным  возмущением.
\begin{equation*}
x^+=\frac{1}{2}x + w, \ w \in [-5,5]
\end{equation*}
\begin{equation*}
S_{\infty} = \sum_{i=0}^{\infty}(\frac{1}{2})^i [-5,5] = [-10, 10]
\end{equation*}
\end{example}

Пусть наше управление выглядит следующим образом:

\begin{equation*}
u_{MPC} = v_{MPC}(x) + K (x - z)
\end{equation*}

Утверждение 1

Пусть $x^+ = Ax + Bu + w$ и $z^+ = Az + Bv$. Если $ x \in Z \oplus S$ и $ u = v + K(x - z)$, тогда $ X^+ \in Z^+ \oplus S$ (инвариантное множество для $x^+ = (A+BK)x + w$)

Представим алгоритм для robust MPC 

В момент времени $t$, дано $x(t)$, решаем 

\begin{equation*}
\min_{z(t|t), v(\cdot|t)} J(x(t),v(\cdot|t)) = \sum_{i = 1}^{t+ N -1}L(z(i|t), v(i|t)) + F(z(t+N|t))
\end{equation*}
\begin{equation*}
s.t. z(i+1|t) = Az(i|t) + Bv(i|t)
\end{equation*}  
\begin{equation*}
z(i|t) \in Z = X \ominus S 
\end{equation*}
\begin{equation*}
v(i|t) \ \in V = U \ominus KS
\end{equation*}
\begin{equation*}
t \leq i \leq t + N -1
\end{equation*}
\begin{equation*}
z(t+N|t) \in Z_N \subseteq Z 
\end{equation*}

Начальные условия $x(t) \in z(t|t) \oplus S$

$\rightarrow$ оптимальные значения для $J^*(x(t))$:
достигаются в $z^*(t|t), v^*(\cdot|t) \rightarrow$  

$\rightarrow$ строим управление для исходной задачи: $u(t) = v^*(t|t) + K(x(t) - z^*(t|t))$

Свойство робастного MPC (введем обозначение $z^*(x(t)):=z^*(t|t)$)
\begin{itemize}
\item достижимое множество $X_N = Z_N \oplus S \subseteq X$
\item $J^*(x) = \hat{J^*}(z^*(x))$ по определению
 $J^*$ и $\hat J^*$
\item $J^*(x) = 0 \ \forall x \in S$
\end{itemize}    


\begin{Theorem} Пусть предположение 1 выполняется
и система робастного MPC достижима в точке $t = 0$.

Тогда: 
\begin{enumerate}
\item задача робастного MPC рекурентно достижима
\item замкнутая система робастно экспоненциально
сходится к  $S$
\itemзамкнутая система удовлетворяет ограничениям
на управление и состояния, то есть $x(t) \in X$, $u(t) \in U \ \forall t = 0,1 ...$
\end{enumerate} 
\end{Theorem}


$|x(i)|_S$ - point-to-set distance

Важным обобщением использования данного метода являются
применение его к системама вида
\begin{equation*}
x(t+1) = A(t)x(t) + B(t)u(t)
\end{equation*}
$(A(t),B(t)) \in \rho : con{(A_j,B_j), j = 1,...,J} \ \forall \geq 0$ 

Введем значения: $\bar{A} := \frac{1}{J}\sum_{i=0}^{J}A_i$, $\bar{B} := \frac{1}{J}\sum_{i=0}^{J}B_i$
\begin{equation*}
x(t+1) = \bar{A}x(t) + \bar{B}u(t) + w(t)
\end{equation*}
\begin{equation*}
w(t) \in W := {(A-\bar{A})x + (B-\bar{B})u | (A,B) \in \rho, x \in X, u \in U}
\end{equation*}
$W$ является компактом, если $X$,$U$ компакты

Как уже говорилось, сложно вычислить в общем случае
минимальное робастное инвариантное множество  $S_{\infty}$. 

\begin{equation*}
S_{\infty} := \sum_{i=0}^{\infty}A^iw
\end{equation*}

Представим один из способов его аппроксимации.

Определим $S_k := \sum_{i=0}^{k-1}A^iw \ k \geq 1$

В общем случае, $S_k$ для конечного $k$ не является
инвариантным (это верно только в том случае, если
 $A$ нильпотентна)

\begin{Theorem}

Если $0 \in int(W)$ и $A$ является матрицей Шура, тогда
существует целое число $k > 0$ и $\alpha \in [0,1)$ такое, что
\begin{equation}\label{RPI_set_subset_with_alpha}
A^kW \subseteq \alpha W
\end{equation} 

Если (\ref{RPI_set_subset_with_alpha}) выполняется, то
\begin{equation*}
S(\alpha,k) := (1-\alpha)^{-1}S_k
\end{equation*}
является инвариантным множеством для $x^+ = Ax + w$

\end{Theorem}

Представим алгоритм для нахождения инвариантного
множества
\begin{enumerate}
\item Фиксируем $\alpha \in (0,1)$ и целое $k > 0$
\item проверяем, выполняется ли (\ref{RPI_set_subset_with_alpha}) holds:
\begin{itemize}
\item если да: $S(\alpha,k)$ это инвариантное множество
\item если нет: устанавливаем $k := k+1$ и
переходим к шагу (2)
\end{itemize}
\end{enumerate}
   