\section{MPC на квази-бесконечном горизонте}

Цель: ослабить ограничения нулевой терминальной задачи

Идея: терминальная функкция + локальная функция управления Ляпунова

Задача оптимизации MPC. В момент времени $t$
\begin{equation*}
\min_{\bar u(\cdot;t)} J(x(t),\bar u(\cdot;t)) = \int_t^{t+T}L(\bar x(\tau;t), \bar u(\tau;t))d\tau + F(\bar x(t+T;t)) 
\end{equation*}

$F(\bar x(t+T;t))$ - терминальная стоимость

такая что

\begin{equation*}
\dot{\bar x} = f(\bar x, \bar u), \bar x(t;t) = x(t)
\end{equation*}
\begin{equation*}
\bar x(t;t) \in X \ \bar u(t;t) \in U \ \forall \tau \in [t,t+T]
\end{equation*}
\begin{equation*}
\bar x(t+T;t) \in X^f
\end{equation*}

$X^f$ - терминальный регион

Оптимальное решение: $\bar u^*(\cdot, t), \ J^*(x(t))$

Предположение 1: Терминальный регион + терминальное управление

Пусть существует локальное вспомогательное
управление $u = k^{loc}(x)$ такое что
\begin{enumerate}
\item $X^f$ является инвариантным множеством для
 $\dot x = f(x,k^{loc}(x))$
\item $k^{loc}(x) \in U \ \forall x \in X^f$
\item $\dot F(x) + L(x, k^{loc}(x)) \leq 0 \ \forall x \in X^f$
\end{enumerate}

$\Rightarrow$ $F$ это локальная функция Ляпунова.

\begin{Theorem}

Предположим, что предположение 1 выполняется и задача
MPC достижима в точке $t=0$. Тогда:
\begin{itemize}
\item рекурсивна достижима
\item закрытая система является асимптотически 
устойчивая
\end{itemize}
\end{Theorem}

Как предположение 1 может быть удовлетворено?

Предположим:
\begin{itemize}
\item функция стоимости перехода является 
квадратической $L(x,u) = x^TQx + u^TRu, \ Q,R >0$
\item линеаризация в нуле стабилизируемая
$\dot x = Ax+Bu \ A = \frac{\partial F}{\partial x}(0,0) \ B = \frac{\partial F}{\partial u}(0,0)$
\end{itemize} 

Подход: 
\begin{itemize}
\item Линейное вспомогательное управление $k^{loc}(x)=Kx$
\item Квадратическая терминальная функция $F(x) = x^TPx$, $P > 0$
\item Терминальный регион $X_{\alpha}^f = \{x \in \mathbb{R}^n | x^TPx \leq \alpha\}$ для некоторой $\alpha > 0$
\item Определим $P,K,\alpha$ так что предположения
 1.1-1.3 выполняются
\end{itemize}

Для предположения 1.3:
\begin{equation*}
\frac{d}{dt}x(t)^TPx(t) \leq - x(t)^t(Q + K^TRK)x(t) = - x(t)^TQ^*x(t)
\end{equation*}
[$x^TQx + u^TRu = [u=Kx] = x^T(Q+K^TRK)x)$]
\begin{equation*}
\frac{d}{dt}x(t)^TPx(t) = f(x,Kx)^TPx + x^TPf(x,Kx)
\end{equation*}
[$f(x,Kx) = (A+BK)x+\phi(x), A+BK = A_K$, $K$ 
выбирается так что $A+BK$ является гурвицевой]

Верхняя граница для $x^TP\phi(x)$:
$L_{\phi} := sup\{ \frac{|\phi(x)|}{|x|}, x \in X_{\alpha}^{f}, x \neq 0\}$
\begin{equation}\label{nonlinearity_inequality}
x^TP\phi(x) \leq |x^TP| |\phi(x)| \leq \| P\| L_{\phi} |x|^2 \leq \frac{\|P\|L_{\phi}}{\lambda_{min}(P)}x^TPx
\end{equation}

Выберем $\alpha$ достаточно малой для 
\begin{equation}\label{alpha_choice}
L_{\phi} \leq \frac{k \lambda_{min}(P)}{\|P\|} 
\end{equation}
для некоторого $k > 0$. Подставим это в (\ref{nonlinearity_inequality}): $x^TP\phi(x) \leq kx^TPx$. 
Подставим это в $\frac{d}{dt}x^TPx \leq x^T(A_KP + PA_K)x + 2kx^TPx$
\begin{equation*}
= x^T((A_K + kI)^TP + P(A_K+kI))x
\end{equation*}
все это нам гарантирует, что $\leq - x^TQ^*x$

$\Rightarrow$ равенство ляпунова может быть решено 
тогда и только тогда, когда $A_K + kI$ является
гурвицевой 
\begin{equation}\label{k_choice_inequality}
\Leftrightarrow k < - max\ Re \{ \lambda(A_K)\}
\end{equation}

\begin{equation}\label{lyapunov_equation}
\Rightarrow\ (A_K + kI)^TP + P(A_K + kI) = - Q^*
\end{equation}

Представим ниже весь алгоритм
\begin{enumerate}
\item Найдем $K$ такое что $(A+BK)$ гурвицева 
\item Выберем $k > 0$ такую что  (\ref{k_choice_inequality}) и решаем (\ref{lyapunov_equation})
\item Найдем наибольшее $\alpha_1$ такое что $Kx \in U, \ \forall x \in X^f_{\alpha_1}$ 
\item Найдем наибольшее $\alpha \in (0,\alpha_1]$ такое
что (\ref{alpha_choice}) выполняется.
\end{enumerate}

Шаг (4) мы можем заменить на альтернативный

Решить задачу оптимизации 
\begin{equation}
\max_{x} x^TP\phi(x) - kx^TPx \ s.t. \ x^TPx \leq \alpha
\end{equation}

Постепенно будем уменьшать $\alpha$ относительно 
$\alpha_1$ до тех пор, пока оптимальное значение
(4) является отрицательным.

В итога мы имеем следующие степени свободы:
\begin{itemize}
\item нахождение $K$
\item выбор $k$ определяет компромисс между "большим"
терминальным регионом и большим $P$
\end{itemize}
