\section{Квазибесконечный MРС}

Ослабим ограничения-равенства в терминальный момент времени и потребуем от траектории попадания не в начало координат, а на некоторое терминальное множество $X^f$.  Внутри терминального множества $X^f$ введем локальную функцию Ляпунова системы с управлением $F$, которая определяет еще один новый элемент задачи  --- терминальное слагаемое $F(\bar x(t+T;t))$ в критерии качества, за счет которой обеспечивается сходимость к  началу координат.

Большинство современных схем МРС вкладываются в общую схему с терминальным множеством и терминальным слагаемым в критерии качества \cite{Fontes}. Впервые такой подход для стабилизации нелинейных непрерывных систем с ограничениями был предложен в рамках квазибесконечного МРС (Quasi-Infinite MPC)  в работе \cite{ChenAllgower}.

Задача МРС $\bar P(x(t))$ в новом подходе выглядит следующим образом:
\begin{equation}\label{1mpc_qi}
    J^*(x(t)) = \min_{\bar u(\cdot;t)} \int_t^{t+T}L(\bar x(\tau;t), \bar u(\tau;t))d\tau + F(\bar x(t+T;t)),
    \end{equation}
при условиях
\begin{equation*}
\dot{\bar x} = f(\bar x, \bar u),  \ \ \bar x(t;t) = x(t),
\end{equation*}
\begin{equation*}
\bar x(t;t) \in X, \ \ \bar u(t;t) \in U, \ \ \tau \in [t,t+T],
\end{equation*}
\begin{equation*}
\bar x(t+T;t) \in X^f,
\end{equation*}
где $F:\R^n \to \R$ --- функции стоимости терминального состояния, $X^f$ --- терминальное множество. 

Как и прежде, $\bar u^*(\cdot; t)$ --- оптимальное программное управление, $J^*(x(t))$ --- оптимальное значение задачи (\ref{1mpc_qi}).

Введем предположения относительно терминального множества и терминальной функции:

\begin{assumption}\label{1Ass:QI} Пусть существует локальная обратная связь 
$$
    u = k^{loc}(x), \ \ x\in X_f,
$$ такая что
\begin{enumerate}[label=\roman*.]
\item Множество $X^f$ является инвариантным множеством для  системы, замкнутой локальной обратной связью $\dot x = f(x,k^{loc}(x))$.
\item Имеет место включение  $k^{loc}(x) \in U$, $x \in X^f$, т.е. локальная обратная связь является допустимой для всех состояний терминального множества.
\item Выполняется неравенство $\dot F(x) + L(x, k^{loc}(x)) \leq 0$, $x \in X^f$.
\end{enumerate}
\end{assumption}

Сделанные предположения означают, что $F$ --- локальная функция Ляпунова системы с управлением \cite{Khalil}.

\begin{theorem} Пусть выполняются предположения \ref{1Ass:QI}, и задача
MPC (\ref{1mpc_qi}) разрешима в начальный момент времени $t=0$. Тогда
\begin{enumerate}
\item Задача MPC (\ref{1mpc_qi}) рекуррентно разрешима.
\item Замкнутая система является асимптотически устойчивой.
\end{enumerate}
\end{theorem}

Согласно \cite{ChenAllgower}, предположения \ref{1Ass:QI} о терминальной функции и терминальном множестве можно удовлетворить следующим образом.

Пусть
\begin{enumerate}[label=\roman*.]
\item функция стоимости этапа является выпуклой квадратичной 
$$
    L(x,u) = x^TQx + u^TRu, \ Q,R >0;
    $$
\item линеаризация системы (\ref{1object}) в нуле 
$$
    \dot x = Ax+Bu, \ \ 
     A = \frac{\partial F}{\partial x}(0,0), \ B = \frac{\partial F}{\partial u}(0,0),
     $$
стабилизируема \cite{AfanasievKolmanovskiNosov}.
\end{enumerate}

Тогда будем искать локальную обратную связь, терминальную функцию и терминальное множество в следующем виде:
\begin{itemize}
\item Локальная обратная связь --- линейная: $k^{loc}(x)=Kx$.
\item Терминальная функция --- квадратичная: $F(x) = x^TPx$, $P > 0$.
\item Терминальное множество --- эллипсоид: $X_{\alpha}^f = \{x \in \R^n | x^TPx \leq \alpha\}$ для некоторого $\alpha > 0$.
\end{itemize}

Определим параметры $K, P,\alpha$ так чтобы выполнялись предположения~\ref{1Ass:QI}. Во-первых, выберем $K$ таким образом, чтобы матрица $A_K = A+BK = A_K$ была гурвицевой. Существование такой матрицы следует из стабилизируемости линеаризации системы (\ref{1object}).

Во-вторых, для определения матрицы $P$ перепишем
неравенство iii в предположении \ref{1Ass:QI}:
\begin{equation*}
\frac{d}{dt}x(t)^TPx(t) \leq -L(x(t),k^{loc}(x(t)))  = - x(t)^T(Q + K^TRK)x(t) = - x(t)^TQ^*x(t).
\end{equation*}
Слева производная квадратичной терминальной функции в силу динамики системы имеет вид
\begin{equation*}
\frac{d}{dt}x(t)^TPx(t) = f(x(t),Kx(t))^TPx(t) + x(t)^TPf(x(t),Kx(t)).
\end{equation*}
Используя линеаризацию, имеем $f(x,Kx) = (A+BK)x+\phi(x)$, откуда
\begin{equation}\label{diff_term_func}
\frac{d}{dt}x(t)^TPx(t) = x(t)^T(A_KP + PA_K)x(t) + 2x(t)^TP\phi(x(t)).
\end{equation}

Теперь необходимо оценить сверху слагаемое $x^TP\phi(x)$.
Пусть внутри терминального множества 
$L_{\phi} := \sup\{ {||\phi(x)||}/{||x||}, x \in X_{\alpha}^{f}, x \neq 0\}$. 
Тогда требуемая оценка  может быть получена следующим образом
\begin{equation}\label{nonlinearity_inequality}
x^TP\phi(x) \leq \|x^TP\|\cdot \|\phi(x)\| \leq \| P\|\cdot L_{\phi} \cdot\|x\|^2 \leq \frac{\|P\|\cdot L_{\phi}}{\lambda_{\min}(P)} x^TPx,
\end{equation}
где $\lambda_{\min}(P)>0$ --- минимальное собственное значение матрицы $P>0$.

Выберем $\alpha$ достаточно малым, так чтобы для некоторого $k > 0$ выполнялось неравенство
\begin{equation}\label{alpha_choice}
L_{\phi} \leq \frac{k \lambda_{min}(P)}{\|P\|}.
\end{equation}

Используя (\ref{alpha_choice}) в (\ref{nonlinearity_inequality}), получим:  $x^TP\phi(x) \leq kx^TPx$. Тогда (\ref{diff_term_func}):
\begin{align*}
\frac{d}{dt}x(t)^TPx(t) & \leq x(t)^T(A_KP + PA_K)x(t) + 2kx(t)^TPx(t) = \\
& = x(t)^T((A_K + kI)^TP + P(A_K+kI))x(t).
\end{align*}

Теперь матрицу $P$ определим как решение уравнения Ляпунова
\begin{equation}\label{lyapunov_equation}
    (A_K + kI)^TP + P(A_K + kI) = - Q^*,
\end{equation}
которое имеет решение тогда и только когда матрица $A_K + kI$ является гурвицевой, чего можно добиться, выбирая параметр $k$ согласно следующему неравенству
\begin{equation}\label{k_choice_inequality}
k < - \max\ Re \{ \lambda(A_K)\}.
\end{equation}

Окончательно, получим
$$
    \frac{d}{dt}x^TPx \leq - x^TQ^*x,
    $$
что влечет инвариантность множества $X_{\alpha}^f$ для системы (\ref{1object}) с линейной обратной связью $k^{loc}(x) = Kx$.

Таким образом, алгоритм нахождения терминальной функции и множества:
\begin{enumerate}
\item Решить задачу стабилизации для линеаризации системы (\ref{1object}) в окрестности начала координат, т.е. найдем  $K$ такое, что $(A+BK)$ гурвицева; тогда $u = Kx$ --- локальная обратная связь.
\item Выбрать $k > 0$ такое, что верно неравенство  (\ref{k_choice_inequality}) и решить уравнение Ляпунова (\ref{lyapunov_equation}).
\item Найти наибольшее $\alpha_1$ такое что $Kx \in U \ \forall x \in X^f_{\alpha_1}$, т.е. локальная обратная связь допустима для всех состояний терминального множества, задаваемого как $X_{\alpha_1}^f =\{x \in \R^n | x^TPx \leq \alpha_1\}$.
\item Найдем наибольшее $\alpha \in (0,\alpha_1]$ такое
что выполняется (\ref{alpha_choice}).
\end{enumerate}

Шаг (4)  может быть заменить на альтернативный: будем решать задачу оптимизации
\begin{equation}\label{1alt_alpha}
\max_{x} x^TP\phi(x) - kx^TPx, \ \  \ x^TPx \leq \alpha,
\end{equation}
постепенно уменьшая $\alpha$ относительно
$\alpha_1$ до тех пор, пока оптимальное значение
задачи (\ref{1alt_alpha}) является отрицательным.

В итоге мы имеем следующие степени свободы:
\begin{itemize}
\item нахождение $K$ для локального управления Ляпунова
\item выбор $k$ определяет компромисс между "большим"
 терминальным регионом и большой матрицей $P$ для терминальной функции
\end{itemize}
