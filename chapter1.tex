\chapter{Общие сведения}

Обозначения, используемые в этой главе:
\begin{itemize}
\item Величины без риски: реальные траектории систем
\item Величины с рисками: предсказанные траектории
\item $L$-стоимость перехода
\item $(\cdot;t)$ - значение, предсказанное в момент $t$
\item $T$ - горизонт предсказания
\item Оптимальное значение функции $J^*(x(t)) = J(x(t), \bar u^*(t))$
\end{itemize}

\section{Терминальная задача MPC}

Приведем математическую формулировку для задачи с нулевым терминальным множеством. 

Задача формулируется на основе динамики системы, представляемой как $\dot x = f(x,u)$ с начальной точкой $x(0) = x_0$, где $x \in \mathbb{R}^n$ - вектор состояния, $u \in \mathbb{R}^n$ - вектор управления. 

Множества $X$ и $U$ задают допустимые значения состояния и управления для нашей задачи. Таким образом на систему накладываются ограничения вида $x(t) \in X, \ u \in U, \ \forall t \geq 0$.

Приведем предположения о системе, которые важны для разрешимости системы:
\begin{itemize}
\item Функция $f$ в начале координат $f(0,0) = 0$, значит из этого следует, что $x=0 $ -- точка равновесия для $u = 0$
\item Функция $f: \mathbb{R}^n \times \mathbb{R}^m \to \mathbb{R}^n$ -- дважды непрерывно дифференцируема 
\item Множество $U$ - компактное множество, т.е. ограниченное и замкнутое множество.
\item Множество $X$ - связанное и закрытое множество
\item Для того, чтобы начало координат $(0,0)$ было точкой равновесия системы, необходимо, чтобы начало координат было внутренней точкой множества $X \times U$,что будем записывать как $(0,0) \in int(X \times U)$ 
\end{itemize}

Задача MPC:

В момент $t$, дано начальное состояние $x(t)$ и формулируется следующая задача оптимизации.
\begin{equation}\label{mpc_problem}
\min_{\bar u(\cdot,t)} J(x(t),\bar u(\cdot ;t))
\end{equation}
где $J(x(t),\bar u(\cdot;t)) = \int_{t}^{t+T}L(\bar x(\tau;t),\bar u(\tau;t))d\tau$, $L(\bar x(\tau;t),\bar u(\tau;t))$ - функция стоимости перехода, а $J(x(t),\bar u(\cdot;t))$ - аккумулориванное значение стоимости переходов за время горизонта предсказания $T$, при условиях

\begin{equation*}
\dot{\bar x} = f(x,u), \bar x(t;t) = x(t)
\end{equation*}
\begin{equation*}
\bar u(\tau;t) \in U, \  \bar x(\tau;t) \in X, \  \forall \tau \in [t, t +T] 
\end{equation*}
\begin{equation*}
\bar x(t+T;t) = 0
\end{equation*}

Оптимальное управление открытой системы обозначаем со звездочкой: 
\begin{equation*}
\bar u^* (\cdot;t) = arg\ min_{\bar u(\cdot;t)} J(x(t), \bar u(\cdot; t))
\end{equation*}

Отметим, что настоящая траектория системы может отличаться от предсказанной.

Приведем предположения относительно функции стоимости перехода:
\begin{itemize}
\item Функция $L: \mathbb{R}^n \times \mathbb{R}^m \to \mathbb{R}$ непрерывная и выполняются следующие условия 
\begin{equation}
\left \{
  \begin{tabular}{c}
  $L(0,0)=0$ \\
  $L(x,u) > 0$ \\
  $\forall (x,u) \neq (0,0)$
  \end{tabular}
 \right.
\end{equation}
\item Функция $J^*(x)$ непрерывна в точке $x=0$
\end{itemize}

Алгоритм MPC
\begin{enumerate}
\item В момент времени $t$, вычисляем значения состояния в этот момент времени $x(t)$ и решаем оптимизационную задачу MPC (\ref{mpc_problem}) 
\item Применяем $u_{MPC}(\tau) = \bar u^*(\tau, t) \ \forall t \in [t, t+\delta)$ на временном промежутке $\delta$
\item Устанавливаем $t := t + \delta $ и переходим к шагу 1
\end{enumerate}

Разрешимость: Задача MPC разрешима в момент времени $t$, если существует хотя бы одно управление $\bar u(\cdot; t)$, удовлетворяющее ограничениям.

\begin{Theorem}
Предположим, что
\begin{enumerate}[label=\roman*.]
\item все выше перечисленные предположения относительно динамики системы и функции стоимости переходов выполняются 
\item задача с нулевым терминальным множеством разрешима в момент времени $t = 0$
\end{enumerate}
Тогда верно следующее: 
\begin{itemize}
\item задача MPC рекуррентно разрешима 
\item получаемая в результате замкнутая система 
является асимптотически устойчивой
\end{itemize}

Пусть $D \subset \mathbb{R}^n$ является множеством всех
точек, где выполняется (ii). Тогда $D$ называется 
областью притяжения замкнутой системы.


Приведем идею доказательства, представленной выше теоремы, так
как такой это универсальный подход и он еще будет использоваться в дальнейшем для наших целей.

\begin{proof}

\begin{enumerate}
\item рекуррентная разрешимость доказывается по индукции 
\begin{itemize}
\item достижима в $t=0$ по предположению индукции
\item допустим, что разрешима в момент $t$. Рассмотрим следующее управление:
\begin{equation*}
\bar u(\tau; t+\delta) =
\left \{
  \begin{tabular}{c}
  $\bar u^*(\tau;t), \ \tau \in [t+\delta, t+ T]$ \\
  $0, \ \tau \in [t+T, t+\delta+T]$ 
  \end{tabular}
  \right.
\end{equation*}
Это управление является выполнимым, так как $\bar u^*(\tau;t)$ выполнимо на промежутке $\tau \in [t+\delta, t+ T]$, а так как с помощью этого управления в момент времени $t+T$ мы находимся в $0$, то значит мы можем применять нулевое управление на промежутке $\tau \in [t+T, t+\delta+T]$ и условия для системы не будут нарушаться.
\end{itemize}
\item асимптотическая устойчивость 

Идея в использовании функции $J^*(x(t))$ в качестве функции Ляпунова. 

По прямому методу Ляпунова, если выполняются следующие условия для функции Ляпунова
$ V: [0, \infty) \times D \to \mathbb{R}$, $(t, x) \to V (t, x) $:
\begin{itemize}
\item $ W_1 (x) \le V (t, x) \le W_2 (x) $, $ \forall t \ge 0, \ x \in D $
\item $ \dot V(t, x) \le 0 $, $ \forall t \ge 0, \ x \in D $
\end{itemize}
где $ W_1, W_2: D \to R $ непрерывные и положительно определенные, то $ x^* = 0 $ равномерно устойчив.
  Если далее $ \dot V (t, x) \le -W_3 (x) $, $ \forall t \ge 0, \ x \in D $ и $ W_3: D \to R $
  непрерывная и положительно определенная,то $ x^* = 0 $ равномерно асимптотически устойчива.

Рассмотрим: 
\begin{equation*}
J(x(t+\delta), \bar u(\cdot;t+\delta)) = \int_{t+\delta}^{t+\delta + T} L(\bar x(\tau;t+\delta), \bar u(\tau; t+\delta))d\tau=
\end{equation*} 
\begin{equation*}
= \int_{t+\delta}^{t+T}L(\bar x^*(\tau;t), \bar u^*(\tau;t))d\tau + \int_{t+T}^{t+\delta+T}L(0,0)d\tau (=0) = 
\end{equation*}
Так как $J^*(x(t)) = \int_{t}^{t+T}L(\bar x^*(\tau;t), \bar u^*(\tau;t))d\tau$, то можем переписать в виде 
\begin{equation*}
= J^*(x(t)) - \int_{t}^{t+\delta} L(\bar x^*(\tau;t), \bar u^*(\tau;t))d\tau
\end{equation*}
из оптимальности следует, что $J^*(x(t+\delta)) \leq J(x(t+\delta), \bar u(\cdot;t+\delta))$, а значит
\begin{equation*}
J^*(x(t+\delta)) \leq J(x(t+\delta), \bar u(\cdot;t+\delta)) \leq J^*(x(t)) - \int_{t}^{t+\delta} L(\bar x^*(\tau;t), \bar u^*(\tau;t))d \tau
\end{equation*}
по индукции мы получаем следующее
\begin{equation*}
J^*(x(\infty)) \leq J^*(x(0)) - \int_0^{\infty}L(x_{MPC}(\tau), u_{MPC}(\tau))d\tau
\end{equation*}
\end{enumerate}

\begin{Lemma}[Barbalat's]

Если $\phi$ равномерно непрерывна $\phi: \mathbb{R} \to \mathbb{R}_{\geq 0}$, то выполняется следующее
\begin{equation*}
\lim_{t \to \infty} \int_0^t \phi(\tau)d\tau < \infty \Rightarrow \phi(t)\to 0, t \to \infty
\end{equation*}
\end{Lemma}

Так как $J^*(x(\infty)) \geq 0$ по условию и $J^*(x(0))$ конечно, то $\int_0^{\infty}L(x_{MPC}(\tau), u_{MPC}(\tau))d\tau$ тоже конечно.

Из леммы Barbalat's мы получаем, что
$L \to 0 $ при $t \to \infty$. Следовательно 
мы получаем, что так как $L$ непрерывна и непрерывны аргументы этой функции, то $\|x_{MPC}(t)\| \to 0$ при $t \to \infty \Rightarrow$, а из этого следует сходимость.

\end{proof}
\end{Theorem}