
\chapter{Теоретические основы МРС}

МРС (Model Predictive control), или управление по прогнозирующей модели \cite{Mayne2000, MayneRawlings, GrunePannek} --- современный подход к решению задач теории управления, основанный на последовательном, в каждый момент времени, решении прогнозирующих задач оптимального управления (predictive optimal control problem) с конечным горизонтом управления, сформулированных для математической модели управляемого объекта,  начальное условие которой совпадает с измеренным состоянием объекта. Значение оптимального программного управления прогнозирующей задачи на левом конце промежутка управления используется для управления объектом в текущий момент времени и до тех пор, пока не будет получено и обработано следующее измерение состояния. Управление, которое подается на объект в описанном процессе, представляет собой обратную связь (т.к. оно зависит от измеряемых состояний), свойства которой зависят от конкретного вида прогнозирующей задачи оптимального управления и целей управления объектом (например, стабилизация, регулирование, слежение и др.).

В настоящей главе приводятся основные сведения из теории МРС в применении к классической задаче стабилизации нелинейной системы, обсуждаются основные подходы к построению прогнозирующих задач оптимального управления и свойства результирующих обратных связей.


\section{Задача стабилизации и базовый алгоритм МРС}

Рассматривается  объект управления, поведение которого при $t\ge 0$ описывается нелинейным обыкновенным дифференциальным уравнением
\begin{equation}\label{1object}
    \dot x = f(x,u), \ \ x(0) = x_0,
    \end{equation}
где $x \in X\subseteq\R^n$ --- вектор состояния объекта в момент времени $t$, $u \in U\subseteq\R^r$ --- вектор управляющего воздействия в момент $t$, $x_0\in X$ --- заданное начальное состояние. 

Относительно функции $f: \R^n\times \R^r \to \R^n$ предполагается, что она обеспечивает существование и единственность решения уравнения (\ref{1object}) при любом допустимом управляющем воздействии $u(t)\in U$, $t\ge 0$. Условия, которым должна удовлетворять функция $f$ для выполнения сделанного предположения, можно найти в \cite{Vasiliev}). Ниже будут сформулированы дополнительные требования, накладываемые на функцию $f$, связанные с конкретными задачами оптимального управления.

Множества $X$ и $U$ задают множества допустимых значений состояния и управления объекта. Таким образом, при управлении должны учитываться жесткие ограничения на траекторию фазовой и управляющей переменных 
\begin{equation}\label{1constr}
    x(t) \in X, \ \ u(t) \in U, \  t \geq 0.
    \end{equation}

Будем считать, что начало координат $x=0$ является точкой равновесия (\ref{1object}) при тривиальном управлении $u = 0$, т.е. выполняется  $f(0,0) = 0$. Естественно, при этом должно выполняться условие $(0,0) \in X\times U$.

Задача стабилизации состоит в нахождении управления типа обратной связи $u(x)$, $x\in X$, такого, что замкнутая система $\dot x = f(x, u(x))$, является асимптотический устойчивой \cite{Malkin}. Решение задачи стабилизации может быть найдено из задачи оптимального управления с бесконечным полуинтервалом управления
\begin{equation}\label{1stab_problem}
    P(x_0): \qquad\qquad
    \min_{u(\cdot)} J_{\infty} (x_0, u) 
    \qquad\qquad\qquad\qquad
    \end{equation}
при условиях
$$
    \dot x = f(x,u), \ \ x(0) = x_0,
    $$
$$
    x(t) \in X, \ \ u(t) \in U, \  t \in [0, +\infty),
    $$
где критерий качества имеет вид
$$
    J_{\infty} (x_0, u)  = \int_0^{+\infty} L(x(t), u(t)) dt,
    $$
функция $L: \R^n\times \R^r \to \R$ --- заданная функция, которая носит название стоимости этапа. Если $L(0,0) = 0$, $L(x,u)>0$, для $(x,u) \ne (0,0)$, то целью управления в задаче $P(x_0)$ является перевод системы (\ref{1object}) в начало координат.

Пусть $u^*_{\infty}(t; x_0)$ --- оптимальное программное управление \cite{Pontryagin} в задаче $P(x_0)$, $J_{\infty}^*(x_0)<\infty$ --- оптимальное значение задачи $P(x_0)$. При определенных требованиях, предъявляемых к функциям $f$ и $L$,  система (\ref{1object}), замкнутая обратной связью  $u^*_{\infty}(0;x)$, $x\in X$, т.е. система
$$
    \dot x(t) = f(x(t), u^0_{\infty}(0;x(t))), \ \ t\ge 0,
    $$
является асимптотически устойчивой \cite{Malkin}.


Обратная связь $u^*_{\infty}(0;x)$, $x\in X$, теоретически может быть построена, если решать задачу $P(x(t))$ в каждый текущий момент времени $t$ для текущего состояния $x(t)$ \cite{LeeMarcus}. На практике, однако, реализация такого подхода в общем случае невозможна: основная причина состоит в высокой трудоемкости решения задач с бесконечным полуинтервалом.

На практике применяются подходы, объединенные общим названием МРС (или NMPC, если речь идет о нелинейных задачах), основная идея которых состоит в том, чтобы аппроксимировать задачу  $P(x(t))$ задачей $\bar P(x(t))$ с конечным горизонтом $T$, решение которой может быть получено за разумное время \cite{MayneRawlings}. 

Как правило, новая задача $\bar P(x(t))$ будет содержать, помимо уравнений динамики (\ref{1object}) и ограничений (\ref{1constr}) дополнительные условия, накладываемые на правом конце траектории \cite{Mayne2000}. Эти условия различны для различных схем МРС и необходимы для обеспечения требуемых свойств замкнутой системы, например, асимптотической устойчивости.

Задачу $\bar P(x_0)$ будем называть \textit{прогнозирующей задачей оптимального управления} или \textit{задачей МРС}.

\bigskip

Базовый алгоритм МРС состоит в следующем:

\noindent Для каждого $t = 0, \delta, 2\delta, \ldots$
\begin{enumerate}
\item Измерить текущее состояние $x(t)\in X$ объекта.
\item Решить задачу $\bar P(x(t))$, получить ее оптимальное программное управление 
    $$
        \bar u^*(\tau;t), \ \ \tau \in [t, t+T].
        $$
\item Подать на объект управляющее воздействие 
$$
    u_{MPC}(\tau) = \bar u^*(\tau;t), \ \ \tau \in [t,t+\delta[,
    $$
начиная с момента времени $t$  до получения следующего измерения в момент $t+\delta$.
\end{enumerate}

Ниже обсуждаются три подхода к построению МРС задачи $\bar P(x(t))$: \begin{enumerate}
\item Zero terminal constraint MPC, в котором прогнозирующая задача  задача оптимального управления содержит терминальные ограничения равенства ---  условие попадания траектории в начало координат в терминальный момент времени \cite{Keerthi88};
\item Quiasi-Infinite MPC --- квазибесконечный MРС, в котором задача $P(x(t))$  на бесконечном полуинтервале аппроксимируется на основе применения линейной обратной связи после терминального момента времени \cite{ChenAllgower}.
\item Unconstrained MPC --- безусловный MРС, в котором в терминальный момент времени не накладываются никакие дополнительные условия, что упрощает численное решение  задачи МРС \cite{Grune}.
\end{enumerate}

Отметим, что в силу различных факторов, таких как неточности математического моделирования, неточности реализации обратной связи, возмущения, и др., управления и траектории реального управляемого объекта и прогнозирующей задачи оптимального управления не совпадают. 

Поэтому, чтобы отличать переменные объекта и переменные модели, последние будем снабжать "чертой"\ над переменной. Таким образом, $x(t)$, $u(t)$, $t\ge 0$, --- измеренные состояния и управляющие воздействия объекта (\ref{1object}), $\bar x(\tau;t)$, $\bar u(\tau;t)$, $\tau\in [t,t+T]$, --- переменные оптимизации в задаче МРС $\bar P(x(t))$, определенные на конечном промежутке прогнозирования $[t,t+T]$ длины $T$, начиная с текущего момента $t$. Второй аргумент $t$ здесь подчеркивает, что прогноз делается в текущий момент $t$.

Отметим, что несмотря на то, что ниже результаты представлены для непрерывных систем, существуют их полные аналоги и для дискретных систем.

\section{Задача МРС с терминальными ограничениями-равенствами}

Идеи МРС применялись на практике еще в 1970-х, однако первый подход, гарантирующий устойчивость замкнутой системы был предложен только в 1988 в работе \cite{Keerthi88}. В этом подходе прогнозирующая задача оптимального управления содержала ограничение-равенство для правого конца траектории, который требовалось привести в положение равновесия, в данном случае --- в начало координат.

Тогда задача МРС $\bar P(x(t))$ для измеренного состояния объекта $x(t)$ в момент $t$  формулируется следующим образом:
\begin{equation}\label{1mpc_problem}
    J^*(x(t)) = \min_{\bar u(\cdot;t)} J(x(t),\bar u(\cdot ;t)),
\end{equation}
при условиях
$$
    \dot{\bar x} = f(\bar x,\bar u), \ \ \bar x(t;t) = x(t),
    $$
$$
    \bar u(\tau;t) \in U, \ \ 
    \bar x(\tau;t) \in X, \ \ 
    \tau \in [t, t +T],
    $$
\begin{equation*}
    \bar x(t+T;t) = 0,
    \end{equation*}
где 
$$
    J(x(t),\bar u(\cdot;t)) = \int_{t}^{t+T}L(\bar x(\tau;t),\bar u(\tau;t))d\tau,
    $$
$L(\bar x(\tau;t),\bar u(\tau;t))$ --- функция стоимости этапа,  $J(x(t),\bar u(\cdot;t))$ --- аккумулированное значение стоимости этапов на всем горизонте прогнозирования $T$.

Заметим, что в задаче (\ref{1mpc_problem}) предполагается, что математическая модель точно соответствует динамике реального объекта управления. Такие схемы МРС носят название номинальных (nominal MPC) \cite{Mayne2000}.

Оптимальное программное управление задачи (\ref{1mpc_problem}) обозначим
\begin{equation*}
\bar u^* (\cdot;t) = \arg\min_{\bar u(\cdot;t)} J(x(t), \bar u(\cdot; t)).
\end{equation*}


\bigskip

Таким образом, алгоритм MPC из \cite{Keerthi88} состоит в следующем
\begin{enumerate}
\item В момент времени $t$ измерить текущее состояние $x(t)\in X$ объекта.
\item Решить задачу MPC (\ref{1mpc_problem}).
\item  Применить $u_{MPC}(\tau) = \bar u^*(\tau, t)$, $\tau \in [t, t+\delta)$ для управления объектом на временном промежутке длины $\delta$.
\item Положить $t := t + \delta $ и вернуться к шагу 1.
\end{enumerate}

Для того, чтобы гарантировать асимптотическую устойчивость системы (\ref{1object}), необходимо сделать ряд предположений о правой части дифференциального уравнения (\ref{1object}), ограничениях задачи (\ref{1constr}), функции стоимости этапа $L$, и существовании решения задачи (\ref{1mpc_problem}).

\begin{assumption}\label{1Ass:object} Пусть объект управления, описываемый (\ref{1object}) -- (\ref{1constr}), удовлетворяет следующим условиям:

\begin{enumerate}[label=\roman*.]
\item Функция $f: \mathbb{R}^n \times \mathbb{R}^r \to \mathbb{R}^n$  дважды непрерывно дифференцируема.
\item Множество $U$ --- компакт, т.е. ограниченное и замкнутое множество.
\item Множество $X$ --- связное и замкнутое множество.
\item Точка равновесия --- начало координат $(0,0)$ --- является внутренней точкой множества $X \times U$: $(0,0) \in \intt (X \times U)$.
\end{enumerate}
\end{assumption}

\begin{assumption}\label{1Ass:cost} Относительно параметров критерия качества задачи (\ref{1mpc_problem}) предположим, что функция $L: \R^n \times \R^r \to \R$ непрерывна и выполняются следующие условия:
\begin{enumerate}[label=\roman*.]
\item $L(0,0)=0$,   $L(x,u) > 0$,  $(x,u) \neq (0,0)$.
\item Функция $J^*(x)$ непрерывна в точке $x=0$.
\end{enumerate}
\end{assumption}

При сделанных предположениях, задача MPC (\ref{1mpc_problem}) разрешима (существует оптимальное программное управление) в момент времени $t$, если в ней существует хотя бы одно допустимое управление $\bar u(\cdot; t)$, т.е. такое управление, которое вместе с порождаемой им траекторией удовлетворяет всем ограничениям задачи (\ref{1mpc_problem}).

Пусть $D \subseteq \mathbb{R}^n$ --- множество всех точек $x$, для которых разрешима задача (\ref{1mpc_problem}) в начальный момент времени $t=0$.

\begin{theorem}\label{1Th:Stability}
Пусть выполняются предположения \ref{1Ass:object}, \ref{1Ass:cost} и имеет место начальная разрешимость задачи (\ref{1mpc_problem}), т.е. $x_0\in D$. Тогда
\begin{enumerate}
\item Задача MPC (\ref{1mpc_problem}) рекуррентно разрешима, т.е. для любого момента $t>0$ существует оптимальное программное управление $\bar u^*(\cdot;t)$.
\item Замкнутая система является асимптотически устойчивой с областью притяжения $D$.
\end{enumerate}
\end{theorem} 

Приведем идею доказательства теоремы~\ref{1Th:Stability}, поскольку здесь используется универсальный подход, который будет использоваться далее для целей магистерской диссертации.

\proof 

1. Рекуррентная разрешимость задачи (\ref{1mpc_problem}) доказывается по индукции.

Задача (\ref{1mpc_problem}) разрешима в момент $t=0$ по предположению индукции.

Допустим, что (\ref{1mpc_problem}) разрешима в момент $t$. Для следующего момента $t+\delta$ рассмотрим  управление $\bar u(\tau; t+\delta)$, $\tau \in [t+\delta, t+\delta+T]$, построенное следующим образом:
\begin{equation}\label{1feasible_u}
\bar u(\tau; t+\delta) = \left \{
    \begin{array}{rl}
        \bar u^*(\tau;t), & \tau \in [t+\delta, t+ T], \\
        0, & \tau \in [t+T, t+\delta+T],
  \end{array}
  \right.
\end{equation}
Покажем, что это управление является допустимым в задаче $P(x(t+\delta))$ для точки $x(t+\delta) = \bar x(t+\delta;t)$. Во-первых, $\bar u^*(\tau;t)$ допустимо на промежутке $\tau \in [t+\delta, t+T]$, при этом $x(t+T; t+\delta) = 0$. Во-вторых, в силу $f(0,0) = 0$, имеем, что применение тривиального управления  на промежутке $[t+T, t+\delta+T]$ даст $x(\tau;t+\delta) \equiv 0$, $\tau \in [t+T, t+\delta+T]$, что влечет выполнение терминального ограничения $P(x(t+\delta))$ в задаче $P(x(t+\delta))$. Существование допустимого управления здесь равносильно существованию оптимального.

2. Доказательство асимптотической устойчивости замкнутой системы основано на идее  использования функции $J^*(x(t))$ в качестве функции Ляпунова \cite{Malkin}.

Согласно прямому методу Ляпунова \cite{AfanasievKolmanovskiNosov}, если выполняются следующие условия для функции Ляпунова $V: [0, \infty) \times D \to \R$, $(t, x) \mapsto V (t, x)$:
$$ 
    W_1 (x) \le V (t, x) \le W_2 (x), \ \  t \ge 0, \ x \in D,
    $$
$$
    \dot V(t, x) \le 0 , \ \ t \ge 0, \ x \in D,
    $$
где $ W_1, W_2: D \to \R$ непрерывные и положительно определенные, то положение равновесия $x = 0 $ является равномерно устойчивым с областью притяжения $D$.

Если далее 
$$
    \dot V (t, x) \le -W_3 (x), \ \  t \ge 0, \ x \in D, 
    $$  
где $ W_3: D \to \R $ ---  непрерывная и положительно определенная, то положение равновесия является равномерно асимптотически устойчивым в $D$.

Вычислим значение критерия качества задачи $P(x(t+\delta))$ на допустимом управлении (\ref{1feasible_u}):
\begin{equation*}
    J(x(t+\delta), \bar u(\cdot;t+\delta)) = \int_{t+\delta}^{t+\delta + T} L(\bar x(\tau;t+\delta), \bar u(\tau; t+\delta))d\tau=
\end{equation*}
\begin{equation*}
    = \int_{t+\delta}^{t+T}L(\bar x^*(\tau;t), \bar u^*(\tau;t))d\tau + \int_{t+T}^{t+\delta+T}L(0,0)d\tau.
\end{equation*}
Поскольку 
$$
    J^*(x(t)) = \int_{t}^{t+T}L(\bar x^*(\tau;t), \bar u^*(\tau;t))d\tau,
     $$
то далее можем записать
$$
    J(x(t+\delta), \bar u(\cdot;t+\delta)) = J^*(x(t)) - \int_{t}^{t+\delta} L(\bar x^*(\tau;t), \bar u^*(\tau;t))d\tau.
    $$

Поскольку на оптимальном программном управлении значение критерия качества будет не хуже, чем на допустимом  (\ref{1feasible_u}), то верно неравенство 
$J^*(x(t+\delta)) \leq J(x(t+\delta), \bar u(\cdot;t+\delta))$, а значит
\begin{equation*}
J^*(x(t+\delta)) \leq J(x(t+\delta), \bar u(\cdot;t+\delta)) \leq J^*(x(t)) - \int_{t}^{t+\delta} L(\bar x^*(\tau;t), \bar u^*(\tau;t))d \tau.
\end{equation*}
по индукции мы получаем следующее
\begin{equation*}
J^*(x(\infty)) \leq J^*(x(0)) - \int_0^{\infty}L(x_{MPC}(\tau), u_{MPC}(\tau))d\tau,
\end{equation*}
где $x_{MPC}(t)$, $t\ge 0$, --- траектория замкнутой системы.

Дальнейший анализ основан на лемме Барбалата, которая является фундаментальным результатом асимптотического анализа решений дифференциальных уравнений и одним из базовых инструментов теории управления. Лемма связывает сходимость интеграла со сходимостью его подынтегральной функции:
\begin{lemma}[Барбалат]
Если функция $\phi: \R \to \R_{\geq 0}$ равномерно непрерывна, то выполняется следующее
\begin{equation*}
\lim_{t \to \infty} \int_0^t \phi(\tau)d\tau < \infty \ \ \Rightarrow \ \ \phi(t)\to 0, \ t \to \infty.
\end{equation*}
\end{lemma}

\bigskip

Из предположения \ref{1Ass:cost} следует, что $J^*(x(\infty)) \geq 0$, кроме того, в силу начальной разрешимости оптимальное значение $J^*(x(0))$ конечно. Поэтому 
$$
    \int_0^{\infty}L(x_{MPC}(\tau), u_{MPC}(\tau))d\tau < \infty,
    $$
откуда в силу  леммы Барбалата получаем, что
$L(t) = L(x_{MPC}(t), u_{MPC}(t)) \to 0 $ при $t \to \infty$. Поскольку $L$ непрерывна и непрерывны аргументы этой функции, то $\|x_{MPC}(t)\| \to 0$ при $t \to \infty \Rightarrow$, откуда следует результат теоремы.
\proofend

Добавление тривиального условия $\bar x(t+T) = 0$ на правом конце траектории --- простейшее условие, гарантирующее асимптотическую устойчивость. Основными недостатками данного подхода являются: 1) вычислительные сложности, связанные с (в общем случае нелинейными) ограничениями-равенствами, поскольку точное попадание в конце горизонта в начало координат не всегда выполнимо; 2) маленькой областью притяжения $D$.

Эти недостатки устраняются в следующем подходе. 
